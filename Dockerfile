FROM ubuntu:16.04

RUN apt-get update

RUN apt-get install build-essential libssl-dev libcurl4-gnutls-dev libexpat1-dev gettext unzip wget -y  && apt-get clean

RUN wget https://github.com/git/git/archive/v2.13.6.tar.gz && tar -zxf v2.13.6.tar.gz

RUN cd git-2.13.6 && make prefix=/usr/local all && make prefix=/usr/local install

RUN apt-get install apache2 apache2-utils -y && apt-get clean && rm /etc/apache2/sites-enabled/*

COPY apache-settings.conf /etc/apache2/sites-enabled/

RUN mkdir -p /var/www/html/
ADD generate-exploit.sh /var/www/html/generate-exploit.sh
ADD evil.sh /var/www/html/evil.sh

RUN (cd /var/www/html && chmod +x *.sh)
RUN (cd /var/www/html && ./generate-exploit.sh)
RUN chown -R www-data:www-data /var/www
RUN (cd /var/www/html/malicious.git && git update-server-info)
#ENTRYPOINT ["/usr/sbin/apache2", "-k", "start"]

#ENV APACHE_RUN_USER www-data
#ENV APACHE_RUN_GROUP www-data
#ENV APACHE_LOG_DIR /var/log/apache2

EXPOSE 80
CMD apachectl -D FOREGROUND

